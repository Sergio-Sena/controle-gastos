<!DOCTYPE html>
<html>
<head>
    <title>Recuperar Dados</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #1a1a2e; color: white; }
        .container { max-width: 600px; margin: 0 auto; }
        button { padding: 10px 20px; margin: 10px; background: #00d4ff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        textarea { width: 100%; height: 200px; margin: 10px 0; background: #333; color: white; border: 1px solid #555; padding: 10px; }
        .result { background: #333; padding: 15px; margin: 10px 0; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Recuperar Dados Financeiros</h1>
        
        <h3>1. Verificar localStorage:</h3>
        <button onclick="verificarLocal()">Verificar Dados Locais</button>
        <div id="local-result" class="result"></div>
        
        <h3>2. Verificar GitHub Gist:</h3>
        <input type="text" id="token" placeholder="Cole seu GitHub token aqui" style="width: 100%; padding: 10px; margin: 10px 0;">
        <button onclick="verificarGist()">Buscar no GitHub</button>
        <div id="gist-result" class="result"></div>
        
        <h3>3. Restaurar dados:</h3>
        <textarea id="dados-json" placeholder="Cole os dados JSON aqui para restaurar"></textarea>
        <button onclick="restaurarDados()">Restaurar Dados</button>
        <div id="restore-result" class="result"></div>
    </div>

    <script>
        function verificarLocal() {
            const lancamentos = localStorage.getItem('lancamentos');
            const reserva = localStorage.getItem('reservaEmergencia');
            const gistId = localStorage.getItem('gistId');
            const token = localStorage.getItem('githubToken');
            
            document.getElementById('local-result').innerHTML = `
                <strong>localStorage:</strong><br>
                Lan√ßamentos: ${lancamentos ? JSON.parse(lancamentos).length + ' itens' : 'Vazio'}<br>
                Reserva: R$ ${reserva || '0,00'}<br>
                Gist ID: ${gistId || 'N√£o configurado'}<br>
                Token: ${token ? 'Configurado' : 'N√£o configurado'}
            `;
        }
        
        async function verificarGist() {
            const token = document.getElementById('token').value || localStorage.getItem('githubToken');
            if (!token) {
                document.getElementById('gist-result').innerHTML = 'Token necess√°rio!';
                return;
            }
            
            try {
                const response = await fetch('https://api.github.com/gists', {
                    headers: { 'Authorization': 'token ' + token }
                });
                
                if (response.ok) {
                    const gists = await response.json();
                    const financasGist = gists.find(g => 
                        g.description && g.description.includes('Financas') || 
                        g.files['financas-dados.json']
                    );
                    
                    if (financasGist) {
                        const gistResponse = await fetch(financasGist.url, {
                            headers: { 'Authorization': 'token ' + token }
                        });
                        const gistData = await gistResponse.json();
                        const content = gistData.files['financas-dados.json'].content;
                        
                        document.getElementById('gist-result').innerHTML = `
                            <strong>Encontrado no GitHub!</strong><br>
                            Gist ID: ${financasGist.id}<br>
                            √öltima atualiza√ß√£o: ${new Date(financasGist.updated_at).toLocaleString()}<br>
                            <button onclick="document.getElementById('dados-json').value = \`${content.replace(/`/g, '\\`')}\`">Carregar Dados</button>
                        `;
                    } else {
                        document.getElementById('gist-result').innerHTML = 'Nenhum backup encontrado no GitHub';
                    }
                } else {
                    document.getElementById('gist-result').innerHTML = 'Erro ao acessar GitHub: ' + response.status;
                }
            } catch (error) {
                document.getElementById('gist-result').innerHTML = 'Erro: ' + error.message;
            }
        }
        
        function restaurarDados() {
            try {
                const dados = JSON.parse(document.getElementById('dados-json').value);
                
                localStorage.setItem('lancamentos', JSON.stringify(dados.lancamentos || []));
                localStorage.setItem('reservaEmergencia', (dados.reservaEmergencia || 0).toString());
                
                document.getElementById('restore-result').innerHTML = `
                    <strong>‚úÖ Dados restaurados!</strong><br>
                    ${dados.lancamentos ? dados.lancamentos.length : 0} lan√ßamentos<br>
                    R$ ${dados.reservaEmergencia || 0} de reserva<br>
                    <a href="/" style="color: #00d4ff;">Voltar ao app</a>
                `;
            } catch (error) {
                document.getElementById('restore-result').innerHTML = '‚ùå Erro: ' + error.message;
            }
        }
        
        // Verificar automaticamente ao carregar
        verificarLocal();
    </script>
</body>
</html>